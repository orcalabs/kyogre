{
  "db_name": "PostgreSQL",
  "query": "\nWITH\n    vessels AS (\n        SELECT\n            fiskeridir_vessel_id\n        FROM\n            fiskeridir_ais_vessel_mapping_whitelist\n        WHERE\n            call_sign = $1\n    ),\n    measurements AS (\n        SELECT\n            SUM(\n                COMPUTE_TS_RANGE_PERCENT_OVERLAP (r.fuel_range, $2) * r.fuel_used\n            ) AS fuel_used,\n            RANGE_AGG(r.fuel_range) AS fuel_ranges\n        FROM\n            vessels v\n            INNER JOIN fuel_measurement_ranges r ON v.fiskeridir_vessel_id = r.fiskeridir_vessel_id\n            AND r.fuel_range && $2\n            AND COMPUTE_TS_RANGE_PERCENT_OVERLAP (r.fuel_range, $2) >= 0.5\n    ),\n    overlapping AS (\n        SELECT\n            SUM(\n                CASE\n                    WHEN m.fuel_ranges IS NULL THEN f.estimate\n                    ELSE (\n                        1.0 - COMPUTE_TS_RANGE_MUTLIRANGE_PERCENT_OVERLAP (f.day_range, m.fuel_ranges)\n                    ) * f.estimate\n                END\n            ) AS fuel\n        FROM\n            vessels v\n            INNER JOIN fuel_estimates f ON v.fiskeridir_vessel_id = f.fiskeridir_vessel_id\n            AND f.day_range <@ $2\n            LEFT JOIN measurements m ON m.fuel_ranges && f.day_range\n    )\nSELECT\n    COALESCE(SUM(q.fuel), 0.0) AS \"estimate!\"\nFROM\n    (\n        SELECT\n            fuel\n        FROM\n            overlapping\n        UNION ALL\n        SELECT\n            fuel_used AS fuel\n        FROM\n            measurements\n    ) q\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "estimate!",
        "type_info": "Float8"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "TstzRange"
      ]
    },
    "nullable": [
      null
    ]
  },
  "hash": "ff7dae686500ea6fc0984f580cbd6e8c431385fb2adc9aad0b3efbae45e7d6aa"
}
