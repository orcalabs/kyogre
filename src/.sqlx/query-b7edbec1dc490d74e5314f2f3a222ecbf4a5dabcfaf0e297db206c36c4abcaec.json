{
  "db_name": "PostgreSQL",
  "query": "\nWITH\n    input AS (\n        SELECT\n            UNNEST($1::BIGINT[]) fiskeridir_vessel_id,\n            UNNEST($2::DOUBLE PRECISION[]) fuel,\n            UNNEST($3::TIMESTAMPTZ[]) timestamp,\n            UNNEST($4::DOUBLE PRECISION[]) fuel_after\n    ),\n    top AS (\n        SELECT DISTINCT\n            ON (i.fiskeridir_vessel_id, i.timestamp) i.fiskeridir_vessel_id AS fiskeridir_vessel_id,\n            i.timestamp AS start_ts,\n            i.fuel AS start_fuel,\n            i.fuel_after AS start_fuel_after,\n            f.timestamp AS end_ts,\n            f.fuel AS end_fuel\n        FROM\n            fuel_measurements f\n            INNER JOIN input i ON f.fiskeridir_vessel_id = i.fiskeridir_vessel_id\n            AND f.timestamp > i.timestamp\n        ORDER BY\n            i.fiskeridir_vessel_id,\n            i.timestamp,\n            f.timestamp ASC\n    ),\n    bottom AS (\n        SELECT DISTINCT\n            ON (i.fiskeridir_vessel_id, i.timestamp) i.fiskeridir_vessel_id AS fiskeridir_vessel_id,\n            f.timestamp AS start_ts,\n            f.fuel AS start_fuel,\n            f.fuel_after AS start_fuel_after,\n            i.timestamp AS end_ts,\n            i.fuel AS end_fuel\n        FROM\n            fuel_measurements f\n            INNER JOIN input i ON f.fiskeridir_vessel_id = i.fiskeridir_vessel_id\n            AND f.timestamp < i.timestamp\n        ORDER BY\n            i.fiskeridir_vessel_id,\n            i.timestamp,\n            f.timestamp DESC\n    ),\n    inserted AS (\n        INSERT INTO\n            fuel_measurement_ranges (\n                fiskeridir_vessel_id,\n                start_measurement_ts,\n                start_measurement_fuel,\n                start_measurement_fuel_after,\n                end_measurement_ts,\n                end_measurement_fuel\n            )\n        SELECT\n            *\n        FROM\n            (\n                SELECT\n                    b.fiskeridir_vessel_id,\n                    b.start_ts,\n                    b.start_fuel,\n                    b.start_fuel_after,\n                    b.end_ts,\n                    b.end_fuel\n                FROM\n                    bottom b\n                UNION\n                SELECT\n                    t.fiskeridir_vessel_id,\n                    t.start_ts,\n                    t.start_fuel,\n                    t.start_fuel_after,\n                    t.end_ts,\n                    t.end_fuel\n                FROM\n                    top t\n            ) q\n        WHERE\n            COMPUTE_FUEL_USED (q.start_fuel, q.start_fuel_after, q.end_fuel) > 0.0\n        RETURNING\n            fiskeridir_vessel_id,\n            fuel_range\n    )\nUPDATE trips_detailed t\nSET\n    benchmark_status = $5\nFROM\n    inserted\nWHERE\n    inserted.fiskeridir_vessel_id = t.fiskeridir_vessel_id\n    AND inserted.fuel_range && t.period\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Int8Array",
        "Float8Array",
        "TimestamptzArray",
        "Float8Array",
        "Int4"
      ]
    },
    "nullable": []
  },
  "hash": "b7edbec1dc490d74e5314f2f3a222ecbf4a5dabcfaf0e297db206c36c4abcaec"
}
