{
  "db_name": "PostgreSQL",
  "query": "\nUPDATE trips_detailed\nSET\n    fishing_facilities = q.fishing_facilities\nFROM\n    (\n        SELECT\n            t.trip_id,\n            COALESCE(\n                JSONB_AGG(\n                    DISTINCT JSONB_BUILD_OBJECT(\n                        'tool_id',\n                        f.tool_id,\n                        'barentswatch_vessel_id',\n                        f.barentswatch_vessel_id,\n                        'fiskeridir_vessel_id',\n                        f.fiskeridir_vessel_id,\n                        'vessel_name',\n                        f.vessel_name,\n                        'call_sign',\n                        f.call_sign,\n                        'mmsi',\n                        f.mmsi,\n                        'imo',\n                        f.imo,\n                        'reg_num',\n                        f.reg_num,\n                        'sbr_reg_num',\n                        f.sbr_reg_num,\n                        'contact_phone',\n                        f.contact_phone,\n                        'contact_email',\n                        f.contact_email,\n                        'tool_type',\n                        f.tool_type,\n                        'tool_type_name',\n                        f.tool_type_name,\n                        'tool_color',\n                        f.tool_color,\n                        'tool_count',\n                        f.tool_count,\n                        'setup_timestamp',\n                        f.setup_timestamp,\n                        'setup_processed_timestamp',\n                        f.setup_processed_timestamp,\n                        'removed_timestamp',\n                        f.removed_timestamp,\n                        'removed_processed_timestamp',\n                        f.removed_processed_timestamp,\n                        'last_changed',\n                        f.last_changed,\n                        'source',\n                        f.source,\n                        'comment',\n                        f.comment,\n                        'geometry_wkt',\n                        ST_ASTEXT (f.geometry_wkt),\n                        'api_source',\n                        f.api_source\n                    )\n                ) FILTER (\n                    WHERE\n                        f.tool_id IS NOT NULL\n                ),\n                '[]'\n            ) AS fishing_facilities\n        FROM\n            trips t\n            INNER JOIN fishing_facilities f ON f.fiskeridir_vessel_id = t.fiskeridir_vessel_id\n            AND f.period && t.period\n        WHERE\n            t.trip_id = ANY ($1::BIGINT[])\n        GROUP BY\n            t.trip_id\n    ) q\nWHERE\n    trips_detailed.trip_id = q.trip_id\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Int8Array"
      ]
    },
    "nullable": []
  },
  "hash": "70bfeba5a8f047dd725c164b1a3bda3f2223ca0e4f4aeabb7325d93f032ca008"
}
