{
  "db_name": "PostgreSQL",
  "query": "\nUPDATE trips_detailed\nSET\n    landings = COALESCE(q.landings, '[]'),\n    landing_species_group_ids = COALESCE(q.landing_species_group_ids, '{}'),\n    landing_total_living_weight = COALESCE(q.living_weight, 0),\n    landing_total_gross_weight = COALESCE(q.gross_weight, 0),\n    landing_total_product_weight = COALESCE(q.product_weight, 0),\n    landing_total_price_for_fisher = COALESCE(q.final_price_for_fisher, 0),\n    price_for_fisher_is_estimated = COALESCE(q.price_for_fisher_is_estimated, FALSE)\nFROM\n    (\n        SELECT\n            qi.trip_id,\n            COALESCE(\n                JSONB_AGG(qi.catches) FILTER (\n                    WHERE\n                        qi.catches IS NOT NULL\n                ),\n                '[]'\n            ) AS landings,\n            ARRAY(\n                SELECT DISTINCT\n                    UNNEST(ARRAY_AGG(qi.species_group_ids))\n            ) AS landing_species_group_ids,\n            SUM(qi.living_weight) AS living_weight,\n            SUM(qi.gross_weight) AS gross_weight,\n            SUM(qi.product_weight) AS product_weight,\n            SUM(qi.final_price_for_fisher) AS final_price_for_fisher,\n            BOOL_OR(qi.price_for_fisher_is_estimated) AS price_for_fisher_is_estimated\n        FROM\n            (\n                SELECT\n                    t.trip_id,\n                    ARRAY_AGG(DISTINCT le.species_group_id) FILTER (\n                        WHERE\n                            le.species_group_id IS NOT NULL\n                    ) AS species_group_ids,\n                    JSONB_BUILD_OBJECT(\n                        'living_weight',\n                        COALESCE(SUM(le.living_weight), 0),\n                        'gross_weight',\n                        COALESCE(SUM(le.gross_weight), 0),\n                        'product_weight',\n                        COALESCE(SUM(le.product_weight), 0),\n                        'price_for_fisher',\n                        COALESCE(SUM(le.final_price_for_fisher), 0),\n                        'species_fiskeridir_id',\n                        le.species_fiskeridir_id,\n                        'product_quality_id',\n                        le.product_quality_id\n                    ) AS catches,\n                    SUM(le.living_weight) AS living_weight,\n                    SUM(le.gross_weight) AS gross_weight,\n                    SUM(le.product_weight) AS product_weight,\n                    SUM(le.final_price_for_fisher) AS final_price_for_fisher,\n                    BOOL_OR(\n                        le.price_for_fisher IS NULL\n                        AND le.final_price_for_fisher IS NOT NULL\n                    ) AS price_for_fisher_is_estimated\n                FROM\n                    trips t\n                    INNER JOIN vessel_events v ON t.trip_id = v.trip_id\n                    INNER JOIN landings l ON l.vessel_event_id = v.vessel_event_id\n                    INNER JOIN landing_entries le ON le.landing_id = l.landing_id\n                WHERE\n                    t.trip_id = ANY ($1::BIGINT[])\n                    AND le.product_quality_id IS NOT NULL\n                    AND le.species_fiskeridir_id IS NOT NULL\n                GROUP BY\n                    t.trip_id,\n                    le.product_quality_id,\n                    le.species_fiskeridir_id\n            ) qi\n        GROUP BY\n            qi.trip_id\n    ) q\nWHERE\n    trips_detailed.trip_id = q.trip_id\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Int8Array"
      ]
    },
    "nullable": []
  },
  "hash": "ffd6fc87b40f6633f8b26b0e9ca58ec653c644ed70e00449c3067e9efe01c6e9"
}
