{
  "db_name": "PostgreSQL",
  "query": "\nINSERT INTO\n    hauls (\n        message_id,\n        message_timestamp,\n        start_timestamp,\n        stop_timestamp,\n        ers_activity_id,\n        duration,\n        haul_distance,\n        ocean_depth_end,\n        ocean_depth_start,\n        quota_type_id,\n        start_latitude,\n        start_longitude,\n        stop_latitude,\n        stop_longitude,\n        fiskeridir_vessel_id,\n        vessel_call_sign,\n        vessel_call_sign_ers,\n        vessel_name,\n        vessel_name_ers,\n        vessel_length,\n        catch_location_start,\n        catch_locations,\n        gear_id,\n        gear_group_id,\n        catches,\n        whale_catches\n    )\nSELECT\n    message_id,\n    MIN(message_timestamp),\n    start_timestamp,\n    stop_timestamp,\n    MIN(ers_activity_id),\n    duration,\n    haul_distance,\n    MIN(ocean_depth_end),\n    MIN(ocean_depth_start),\n    MIN(quota_type_id),\n    start_latitude,\n    start_longitude,\n    stop_latitude,\n    stop_longitude,\n    MIN(fiskeridir_vessel_id),\n    MIN(vessel_call_sign),\n    MIN(vessel_call_sign_ers),\n    MIN(vessel_name),\n    MIN(vessel_name_ers),\n    MIN(vessel_length),\n    MIN(catch_location_id),\n    CASE\n        WHEN MIN(catch_location_id) IS NULL THEN NULL\n        ELSE ARRAY[MIN(catch_location_id)]\n    END,\n    gear_id,\n    MIN(gear_group_id),\n    COALESCE(\n        JSONB_AGG(\n            JSONB_BUILD_OBJECT(\n                'living_weight',\n                COALESCE(living_weight, 0),\n                'species_fao_id',\n                species_fao_id,\n                'species_fiskeridir_id',\n                COALESCE(species_fiskeridir_id, 0),\n                'species_group_id',\n                species_group_id,\n                'species_main_group_id',\n                species_main_group_id\n            )\n        ) FILTER (\n            WHERE\n                species_fao_id IS NOT NULL\n        ),\n        '[]'\n    ),\n    COALESCE(\n        JSONB_AGG(\n            JSONB_BUILD_OBJECT(\n                'grenade_number',\n                whale_grenade_number,\n                'blubber_measure_a',\n                whale_blubber_measure_a,\n                'blubber_measure_b',\n                whale_blubber_measure_b,\n                'blubber_measure_c',\n                whale_blubber_measure_c,\n                'circumference',\n                whale_circumference,\n                'fetus_length',\n                whale_fetus_length,\n                'gender_id',\n                whale_gender_id,\n                'individual_number',\n                whale_individual_number,\n                'length',\n                whale_length\n            )\n        ) FILTER (\n            WHERE\n                whale_grenade_number IS NOT NULL\n        ),\n        '[]'\n    )\nFROM\n    (\n        SELECT\n            e.*,\n            start_timestamp,\n            stop_timestamp,\n            start_latitude,\n            start_longitude,\n            stop_latitude,\n            stop_longitude,\n            duration,\n            haul_distance,\n            gear_id,\n            MIN(gear_group_id) AS gear_group_id,\n            MIN(ocean_depth_end) AS ocean_depth_end,\n            MIN(ocean_depth_start) AS ocean_depth_start,\n            SUM(living_weight) AS living_weight,\n            species_fao_id,\n            MIN(species_fiskeridir_id) AS species_fiskeridir_id,\n            MIN(species_group_id) AS species_group_id,\n            MIN(species_main_group_id) AS species_main_group_id,\n            MIN(whale_grenade_number) AS whale_grenade_number,\n            MIN(whale_blubber_measure_a) AS whale_blubber_measure_a,\n            MIN(whale_blubber_measure_b) AS whale_blubber_measure_b,\n            MIN(whale_blubber_measure_c) AS whale_blubber_measure_c,\n            MIN(whale_circumference) AS whale_circumference,\n            MIN(whale_fetus_length) AS whale_fetus_length,\n            MIN(whale_gender_id) AS whale_gender_id,\n            MIN(whale_individual_number) AS whale_individual_number,\n            MIN(whale_length) AS whale_length,\n            MIN(catch_location_id) AS catch_location_id\n        FROM\n            ers_dca e\n            INNER JOIN ers_dca_bodies b ON e.message_id = b.message_id\n            LEFT JOIN catch_locations l ON ST_CONTAINS (\n                l.polygon,\n                ST_POINT (start_longitude, start_latitude)\n            )\n        WHERE\n            e.message_id = ANY ($1::BIGINT[])\n            AND (\n                species_fao_id IS NOT NULL\n                OR whale_grenade_number IS NOT NULL\n                OR gear_id != 0\n            )\n        GROUP BY\n            e.message_id,\n            start_timestamp,\n            stop_timestamp,\n            start_latitude,\n            start_longitude,\n            stop_latitude,\n            stop_longitude,\n            duration,\n            haul_distance,\n            gear_id,\n            species_fao_id\n    ) q\nGROUP BY\n    message_id,\n    start_timestamp,\n    stop_timestamp,\n    start_latitude,\n    start_longitude,\n    stop_latitude,\n    stop_longitude,\n    duration,\n    haul_distance,\n    gear_id\nRETURNING\n    vessel_event_id\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "vessel_event_id",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Int8Array"
      ]
    },
    "nullable": [
      true
    ]
  },
  "hash": "c4bf0552cee56bbad3158a8936be645894bdbd1c574e536444b1e851d68dd66e"
}
